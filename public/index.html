<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>符文战场 - 双人对战</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 登录/房间创建界面 -->
    <div id="lobby" class="screen">
        <div class="lobby-container">
            <h1>符文战场</h1>
            <div class="lobby-actions">
                <div class="action-group">
                    <h2>创建房间</h2>
                    <input type="text" id="playerName" placeholder="输入玩家名称" value="玩家1">
                    <button id="createRoomBtn">创建房间</button>
                </div>
                <div class="action-group">
                    <h2>加入房间</h2>
                    <input type="text" id="joinRoomId" placeholder="输入房间ID">
                    <input type="text" id="joinPlayerName" placeholder="输入玩家名称" value="玩家2">
                    <button id="joinRoomBtn">加入房间</button>
                </div>
            </div>
            <div class="action-group" style="margin-top: 20px; text-align: center;">
                <button id="debugModeBtn" style="padding: 10px 20px; font-size: 14px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">调试模式</button>
            </div>
            <div id="roomInfo" class="room-info" style="display: none;">
                <p>房间ID: <span id="roomIdDisplay"></span> 
                    <button id="copyRoomIdBtn" style="margin-left: 10px; padding: 5px 10px; font-size: 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">复制</button>
                </p>
                <p id="roomStatusText">等待其他玩家加入...</p>
            </div>
        </div>
    </div>

    <!-- 卡组选择界面 -->
    <div id="deckSelection" class="screen" style="display: none;">
        <div class="deck-selection-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">选择卡组</h2>
                <div id="roomInfoInDeckSelection" class="room-info" style="display: none; margin: 0; padding: 10px 20px;">
                    <strong>房间ID: <span id="roomIdDisplayInDeck"></span></strong>
                    <button id="copyRoomIdInDeckBtn" style="margin-left: 10px; padding: 5px 10px; font-size: 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">复制</button>
                    <span id="roomStatusTextInDeck" style="margin-left: 15px;">等待其他玩家加入...</span>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="deckSelect" style="display: block; margin-bottom: 10px; font-size: 16px; font-weight: bold;">选择卡组：</label>
                <div class="custom-select-wrapper">
                    <div class="custom-select" id="customDeckSelect">
                        <div class="custom-select-trigger">
                            <span id="customDeckSelectText">-- 请选择卡组 --</span>
                            <span class="custom-select-arrow">▼</span>
                        </div>
                        <div class="custom-select-options" id="customDeckSelectOptions">
                            <!-- 选项将通过JavaScript动态添加 -->
                        </div>
                    </div>
                    <!-- 隐藏的原生select，用于保持兼容性 -->
                    <select id="deckSelect" style="display: none;">
                        <option value="">-- 请选择卡组 --</option>
                    </select>
                </div>
            </div>
            <div id="selectedDeckInfo" class="selected-deck-info" style="display: none;">
                <h3>已选择卡组</h3>
                <div id="selectedDeckDetails"></div>
            </div>
            
            <!-- 选择英雄和战场 -->
            <div id="heroAndBattlefieldSelection" style="display: none; margin-top: 20px;">
                <h3>选择英雄</h3>
                <div id="heroSelection" class="card-selection"></div>
                <p id="selectedHeroInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></p>
                
                <h3 style="margin-top: 20px;">选择战场</h3>
                <div id="battlefieldSelection" class="card-selection"></div>
                <p id="selectedBattlefieldInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></p>
            </div>
            
            <button id="startGameBtn" style="display: none; margin-top: 20px; padding: 15px 30px; font-size: 18px;">开始游戏</button>
        </div>
    </div>

    <!-- 游戏主界面 -->
    <div id="gameScreen" class="screen" style="display: none;">
        <!-- 第一行：对手区域 + 待结算区域 -->
        <div class="top-row">
            <!-- 对手区域 -->
            <div class="opponent-area">
                <div class="area-label-vertical">对手区域</div>
                <div class="opponent-area-content">
                    <div class="player-info">
                        <h3 id="opponentName">对手</h3>
                        <div class="score">分数: <span id="opponentScore">0</span></div>
                    </div>
                    <div class="area-label-vertical">传奇</div>
                    <div class="opponent-legend" id="opponentLegend"></div>
                    <div class="area-label-vertical">选定英雄</div>
                    <div class="opponent-hero" id="opponentHero"></div>
                    <div class="opponent-deck-info">
                        <div>手牌: <span id="opponentHandCount">0</span></div>
                        <div>主牌堆: <span id="opponentMainDeckCount">0</span></div>
                        <div>符文堆: <span id="opponentRuneDeckCount">0</span></div>
                        <div>废牌堆: <span id="opponentGraveyardCount">0</span>
                            <button id="viewOpponentGraveyardBtn" style="margin-left: 5px; padding: 5px 10px; font-size: 12px;">查看</button>
                        </div>
                        <div class="deck-top" id="opponentDeckTop"></div>
                    </div>
                </div>
            </div>

            <!-- 待结算区域 -->
            <div class="pending-spells-area">
                <div class="area-label-vertical">待结算法术</div>
                <div id="pendingSpells" class="pending-spells card-container"></div>
            </div>
        </div>

        <!-- 第二行：对方基地区域和符文区域 -->
        <div class="opponent-base-runes-row">
            <div class="opponent-base-standalone">
                <div class="area-label-vertical">对方基地</div>
                <div class="opponent-base" id="opponentBase"></div>
            </div>
            <div class="opponent-runes-standalone">
                <div class="area-label-vertical">对方符文</div>
                <div class="opponent-runes" id="opponentRunes"></div>
            </div>
        </div>

        <!-- 第三行：战场区域 -->
        <div class="battlefields-area">
            <div class="battlefield" id="battlefield1">
                <div class="area-label-vertical">战场 1</div>
                <div class="battlefield-content">
                    <div class="battlefield-card-display" id="battlefield1-card-display"></div>
                    <div class="battlefield-units">
                        <div class="area-label-vertical-small">对手单位</div>
                        <div class="units-group opponent-units card-container" id="battlefield1-opponent"></div>
                        <div class="area-label-vertical-small">我的单位</div>
                        <div class="units-group my-units card-container" id="battlefield1-my"></div>
                    </div>
                </div>
            </div>
            <div class="battlefield" id="battlefield2">
                <div class="area-label-vertical">战场 2</div>
                <div class="battlefield-content">
                    <div class="battlefield-card-display" id="battlefield2-card-display"></div>
                    <div class="battlefield-units">
                        <div class="area-label-vertical-small">对手单位</div>
                        <div class="units-group opponent-units card-container" id="battlefield2-opponent"></div>
                        <div class="area-label-vertical-small">我的单位</div>
                        <div class="units-group my-units card-container" id="battlefield2-my"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 第四行：我方基地 + 我方符文 -->
        <div class="my-base-runes-row">
            <div class="my-base-standalone">
                <div class="area-label-vertical">我方基地</div>
                <div class="my-base" id="myBase"></div>
            </div>
            <div class="my-runes-standalone">
                <div class="area-label-vertical">我方符文</div>
                <div class="my-runes" id="myRunes"></div>
            </div>
        </div>

        <!-- 第五行：我方区域 + 手牌 -->
        <div class="my-area-hand-row">
            <!-- 我方区域 -->
            <div class="my-area">
                <div class="area-label-vertical">我方区域</div>
                <div class="my-area-content">
                    <div class="player-info">
                        <h3 id="myName">我</h3>
                        <div class="score">分数: <span id="myScore">0</span></div>
                        <button id="increaseScoreBtn">+1</button>
                        <button id="decreaseScoreBtn">-1</button>
                    </div>
                    <div class="area-label-vertical">传奇</div>
                    <div class="my-legend" id="myLegend"></div>
                    <div class="area-label-vertical">选定英雄</div>
                    <div class="my-hero" id="myHero"></div>
                    <div class="my-deck-info">
                        <div>手牌: <span id="myHandCount">0</span></div>
                        <div>主牌堆: <span id="myMainDeckCount">0</span> 
                            <button id="drawCardBtn">抽牌</button>
                            <button id="viewDeckTopBtn">查看牌堆顶</button>
                        </div>
                        <div>符文堆: <span id="myRuneDeckCount">0</span>
                            <button id="drawRuneBtn">抽符文</button>
                        </div>
                        <div>废牌堆: <span id="myGraveyardCount">0</span>
                            <button id="viewGraveyardBtn">查看废牌堆</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 手牌区域 -->
            <div class="hand-area-standalone">
                <div class="area-label-vertical">手牌</div>
                <div class="my-hand card-container" id="myHand"></div>
            </div>
        </div>

        <!-- 操作按钮区域 -->
        <div class="action-buttons">
            <button id="shuffleMainDeckBtn">洗混主牌堆</button>
            <button id="shuffleRuneDeckBtn">洗混符文堆</button>
            <button id="createTokenBtn">创建指示物单位</button>
            <button id="untapAllBtn">一键竖置所有横置卡牌</button>
        </div>
    </div>

    <!-- 卡牌详情弹窗 -->
    <div id="cardModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="cardModalContent"></div>
            <div id="cardModalActions"></div>
        </div>
    </div>

    <!-- 废牌堆查看弹窗 -->
    <div id="graveyardModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>废牌堆</h3>
            <div id="graveyardContent" class="card-grid"></div>
        </div>
    </div>

    <!-- 牌堆顶查看弹窗 -->
    <div id="deckTopModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>牌堆顶</h3>
            <div id="deckTopContent" class="card-grid"></div>
        </div>
    </div>

    <!-- 区域选择对话框 -->
    <div id="areaSelectionModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close">&times;</span>
            <h3>选择目标区域</h3>
            <div id="areaSelectionButtons" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px;"></div>
        </div>
    </div>

    <!-- 是/否选择对话框 -->
    <div id="yesNoModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close">&times;</span>
            <h3 id="yesNoTitle">确认</h3>
            <p id="yesNoMessage" style="margin: 20px 0;"></p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="yesBtn" style="padding: 10px 30px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">是</button>
                <button id="noBtn" style="padding: 10px 30px; font-size: 16px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">否</button>
            </div>
        </div>
    </div>

    <!-- 指示物单位选择对话框 -->
    <div id="tokenSelectionModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close">&times;</span>
            <h3>选择指示物单位</h3>
            <div id="tokenSelectionGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;"></div>
        </div>
    </div>

    <script src="js/game.js"></script>
    <script src="js/cardOperations.js"></script>
</body>
</html>

